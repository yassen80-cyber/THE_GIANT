<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ“˜ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª - Ù…Ù†ØµØ© THE GIANT</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #00b2ff;
    --bg-dark: #0b0f19;
    --card-bg: #1e2636;
    --text-main: #ffffff;
    --text-muted: #a0aec0;
    --danger: #ef4444;
    --success: #10b981;
  }

  body {
    margin: 0;
    font-family: "Cairo", sans-serif;
    background: var(--bg-dark);
    color: var(--text-main);
    line-height: 1.6;
  }

  header {
    background: #111827;
    padding: 1rem 5%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  header h1 { color: var(--primary); margin: 0; font-size: 1.2rem; }

  .back-btn {
    background: transparent;
    color: var(--primary);
    border: 1px solid var(--primary);
    padding: 0.5rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: 0.3s;
  }

  .back-btn:hover { background: var(--primary); color: #fff; }

  .container {
    max-width: 800px;
    margin: 2rem auto;
    padding: 0 1rem;
  }

  .admin-card {
    background: var(--card-bg);
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  }

  h2 {
    font-size: 1.1rem;
    color: var(--primary);
    margin-top: 0;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  input, textarea, select {
    width: 100%;
    padding: 0.75rem;
    margin-bottom: 1rem;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    background: #111827;
    color: #fff;
    font-family: inherit;
    box-sizing: border-box;
  }

  input:focus, select:focus {
    outline: none;
    border-color: var(--primary);
  }

  .add-btn {
    background: var(--primary);
    color: #fff;
    border: none;
    padding: 0.8rem;
    width: 100%;
    font-weight: 700;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.3s;
  }

  .add-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,178,255,0.3); }

  .section { display: none; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.05); }
  .visible { display: block; animation: fadeIn 0.4s ease; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  .content-item {
    background: #161d2b;
    border-right: 4px solid var(--primary);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .content-info h3 { margin: 0; font-size: 1rem; color: #fff; }
  .content-info p { margin: 5px 0 0; font-size: 0.85rem; color: var(--text-muted); }
  .price-tag { color: var(--primary); font-weight: bold; font-size: 0.9rem; margin-top: 5px; display: block; }

  .delete-btn {
    background: rgba(230, 57, 70, 0.1);
    color: var(--danger);
    border: 1px solid var(--danger);
    padding: 0.4rem 0.8rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.8rem;
  }

  .delete-btn:hover { background: var(--danger); color: #fff; }

  .giant-alert-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 9999; }
  .giant-alert-box { background: var(--card-bg); border-radius: 20px; padding: 2rem; text-align: center; width: 85%; max-width: 350px; }
  .giant-alert-box button { background: var(--primary); color: #fff; border: none; padding: 0.6rem 2rem; border-radius: 8px; margin-top: 1rem; cursor: pointer; }

  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
</style>
</head>
<body>

<header>
  <h1>ğŸ“˜ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h1>
  <button class="back-btn" onclick="window.location.href='admin.html'">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
</header>

<div class="container">
  
  <div class="admin-card">
    <h2>ğŸ¯ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„ÙƒÙˆØ±Ø³/Ø§Ù„ØµÙ ÙˆØ§Ù„Ù†ÙˆØ¹</h2>
    <select id="targetType">
      <option value="course">ğŸ« ÙƒÙˆØ±Ø³ Ù…Ø­Ø¯Ø¯</option>
      <option value="grade">ğŸ“š ØµÙ Ø¯Ø±Ø§Ø³ÙŠ Ø¹Ø§Ù…</option>
    </select>
    <select id="courseSelect"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© --</option></select>
    <select id="contentType">
      <option value="">-- Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØ¶ÙŠÙ Ø§Ù„Ø¢Ù†ØŸ --</option>
      <option value="Ø´Ø±Ø­">ğŸ“– Ø¥Ø¶Ø§ÙØ© Ø­ØµØ© / ÙÙŠØ¯ÙŠÙˆ Ø´Ø±Ø­</option>
      <option value="Ø§Ù…ØªØ­Ø§Ù†">ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯</option>
      <option value="ÙˆØ§Ø¬Ø¨">ğŸ“š Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø¬Ø¨ Ø¯Ø±Ø§Ø³ÙŠ</option>
      <option value="Ù…Ø¬Ø§Ù†ÙŠ">ğŸ¥ ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ</option>
    </select>
  </div>

  <div class="admin-card" id="formContainer" style="display: none;">
    
    <div id="lessonSection" class="section">
      <h2>ğŸ“– ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­ØµØ©</h2>
      <input type="text" id="lessonTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­ØµØ© (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰)">
      <textarea id="lessonNote" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ Ø¨Ø³ÙŠØ·Ø§Ù‹ Ù„Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø­ØµØ©..."></textarea>
      <div class="grid-2">
          <input type="text" id="lessonVideo" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (YouTube / Drive)">
          <input type="number" id="lessonPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± (0 = Ù…Ø¬Ø§Ù†ÙŠ)">
      </div>
      <button id="addLessonBtn" class="add-btn">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø­ØµØ©</button>
    </div>

    <div id="freevidSection" class="section">
      <h2>ğŸ¥ ÙÙŠØ¯ÙŠÙˆ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ø¹Ø§Ù…Ø©</h2>
      <input type="text" id="freevidTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
      <input type="text" id="freevidLink" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
      <button id="addFreevidBtn" class="add-btn">Ø¥Ø¶Ø§ÙØ© Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ</button>
    </div>

    <div id="examSection" class="section">
      <h2>ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</h2>
      <input type="text" id="examTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†">
      <div class="grid-2">
         <input type="number" id="examTime" placeholder="Ø§Ù„Ù…Ø¯Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)">
         <span style="font-size: 0.8rem; color: var(--text-muted)">Ø§ØªØ±Ùƒ Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø£Ø³ÙÙ„</span>
      </div>
      <textarea id="examDesc" placeholder="ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù„Ù„Ø·Ø§Ù„Ø¨"></textarea>
      <button id="addExamBtn" class="add-btn">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ÙˆØ¯Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
    </div>

    <div id="homeworkSection" class="section">
      <h2>ğŸ“š Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø¬Ø¨</h2>
      <input type="text" id="homeworkTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ§Ø¬Ø¨">
      <textarea id="homeworkDesc" placeholder="Ù…Ø§ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙˆØ§Ø¬Ø¨ØŸ"></textarea>
      <button id="addHomeworkBtn" class="add-btn">Ø­ÙØ¸ Ø§Ù„ÙˆØ§Ø¬Ø¨</button>
    </div>

    <div id="questionSection" class="section" style="margin-top: 2rem; border-top: 2px dashed #333; padding-top: 1rem;">
      <h2 style="color: #ff9f43;">â“ Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¦Ù„Ø©</h2>
      <select id="targetSelect"><option value="">-- Ø­Ø¯Ø¯ (Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†/Ø§Ù„ÙˆØ§Ø¬Ø¨) Ø§Ù„Ø°ÙŠ Ø³ØªØ¶ÙŠÙ Ù„Ù‡ --</option></select>
      
      <select id="questionType">
        <option value="Ø§Ø®ØªÙŠØ§Ø±ÙŠ">Ø³Ø¤Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
        <option value="Ù…Ù‚Ø§Ù„ÙŠ">Ø³Ø¤Ø§Ù„ Ù…Ù‚Ø§Ù„ÙŠ (Ù†ØµÙŠ)</option>
      </select>
      
      <input type="text" id="questionText" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„">
      <div id="optionsGroup">
        <input type="text" id="opt1" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„">
        <input type="text" id="opt2" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ">
        <input type="text" id="opt3" placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«">
      </div>
      <input type="text" id="correct" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©">
      <button id="addQuestionBtn" class="add-btn" style="background: #ff9f43;">Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¢Ù†</button>
    </div>

  </div>

  <div class="admin-card">
    <h2>ğŸ“‚ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
    <div id="contentContainer">
      <p style="text-align: center; color: var(--text-muted)">Ø§Ø®ØªØ± ÙˆØ¬Ù‡Ø© Ù„Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡Ø§</p>
    </div>
  </div>

  <div class="admin-card">
    <h2>ğŸŒ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©)</h2>
    <div id="freevidContainer"></div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getDatabase, ref, get, push, set, remove, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDW80ZbwOB7QHHW76kSL9cqlzMoyPFZ7nI",
  authDomain: "ylearn-fe1fa.firebaseapp.com",
  databaseURL: "https://ylearn-fe1fa-default-rtdb.firebaseio.com",
  projectId: "ylearn-fe1fa",
  storageBucket: "ylearn-fe1fa.firebasestorage.app",
  messagingSenderId: "1092852055944",
  appId: "1:1092852055944:web:85c3df7cf4c0cbcdca043d"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const courseSelect = document.getElementById("courseSelect");
const targetType = document.getElementById("targetType");
const contentType = document.getElementById("contentType");
const formContainer = document.getElementById("formContainer");
const contentContainer = document.getElementById("contentContainer");
const targetSelect = document.getElementById("targetSelect");

let selectedCourseId = null;
let currentUser = null;

function giantAlert(msg){
  const overlay=document.createElement("div");
  overlay.className="giant-alert-overlay";
  overlay.innerHTML=`<div class="giant-alert-box"><h3>THE GIANT</h3><p>${msg}</p><button id="closeAlert">Ø­Ø³Ù†Ø§Ù‹</button></div>`;
  document.body.appendChild(overlay);
  document.getElementById("closeAlert").onclick = () => overlay.remove();
}

async function init() {
  try {
    await setPersistence(auth, browserLocalPersistence);
    onAuthStateChanged(auth, async (user) => {
      if(user) { 
        // ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ù„Ù€ UID Ù„ÙŠØ¨Ø¯Ø£ Ø¨Ø­Ø±Ù L ÙƒØ¨ÙŠØ± ÙƒÙ…Ø§ Ø£Ø±Ø³Ù„ØªÙ‡
        if (user.uid !== "lSpi591awfQMcRFU62CAM3108Hu1") {
          window.location.href = "index.html";
          return;
        }
        currentUser = user; 
        await loadCourses();
        await loadFreevids();
      }
      else { window.location.href = "login.html"; }
    });
    setupEventListeners();
  } catch (err) { console.error("Initialization Error:", err); }
}

async function loadCourses(){
  const type = targetType.value;
  courseSelect.innerHTML=`<option value="">-- Ø§Ø®ØªØ± ${type === "course" ? 'Ø§Ù„ÙƒÙˆØ±Ø³' : 'Ø§Ù„ØµÙ'} Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù --</option>`;
  
  if(type === "grade") {
    const grades = [
      {id: "1prim", name: "Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ"}, {id: "2prim", name: "Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ"}, {id: "3prim", name: "Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ"},
      {id: "4prim", name: "Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ"}, {id: "5prim", name: "Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ"}, {id: "6prim", name: "Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ"},
      {id: "1prep", name: "Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ"}, {id: "2prep", name: "Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ"}, {id: "3prep", name: "Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ"},
      {id: "1sec", name: "Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ"}, {id: "2sec", name: "Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ"}, {id: "3sec", name: "Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ"}
    ];
    grades.forEach(g => {
      const opt = document.createElement("option");
      opt.value = g.id;
      opt.textContent = g.name;
      courseSelect.appendChild(opt);
    });
  } else {
    const snap = await get(ref(db, "courses"));
    if(snap.exists()){
      Object.entries(snap.val()).forEach(([id,c])=>{
        const opt=document.createElement("option");
        opt.value=id; opt.textContent=c.name; courseSelect.appendChild(opt);
      });
    }
  }
}

async function loadContent(){
  if(!selectedCourseId) {
      contentContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted)">Ø§Ø®ØªØ± ÙˆØ¬Ù‡Ø© Ù„Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡Ø§</p>';
      return;
  }
  
  contentContainer.innerHTML='<p style="text-align:center">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
  const type = targetType.value;
  let combinedData = {};

  try {
    if(type === "course") {
      const snap = await get(ref(db, `courses/${selectedCourseId}/content`));
      if(snap.exists()) combinedData = snap.val();
    } else {
      const [contSnap, vidSnap] = await Promise.all([
        get(ref(db, `grades/${selectedCourseId}/content`)),
        get(ref(db, `grades/${selectedCourseId}/videos`))
      ]);
      combinedData = { ...(contSnap.val() || {}), ...(vidSnap.val() || {}) };
    }
    
    contentContainer.innerHTML = "";
    if(Object.keys(combinedData).length === 0){
        contentContainer.innerHTML="<p style='text-align:center'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù…Ø¶Ø§Ù Ù‡Ù†Ø§.</p>";
        return;
    }
    
    const items = Object.entries(combinedData).sort((a,b) => (b[1].createdAt || 0) - (a[1].createdAt || 0));
    
    items.forEach(([id,item])=>{
      if(item.teacher !== currentUser?.uid) return;
      
      const div=document.createElement("div");
      div.className="content-item";
      const icon = item.type==="Ø§Ù…ØªØ­Ø§Ù†"?"ğŸ“":item.type==="ÙˆØ§Ø¬Ø¨"?"ğŸ“š":"ğŸ“–";
      
      const priceHtml = item.type === "Ø´Ø±Ø­" ? `<span class="price-tag">Ø§Ù„Ø³Ø¹Ø±: ${item.price || 0} Ø¬.Ù…</span>` : "";

      div.innerHTML=`
        <div class="content-info">
          <h3>${icon} ${item.title}</h3>
          <p>${item.type} | ${item.note||item.desc||"Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ"}</p>
          ${priceHtml}
        </div>
        <div class="item-actions">
          <button class="edit-btn" onclick="editContent('${id}', '${item.type}')">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="delete-btn" onclick="deleteContent('${id}', '${item.type}')">Ø­Ø°Ù</button>
        </div>
      `;
      contentContainer.appendChild(div);
    });
  } catch (err) {
    contentContainer.innerHTML="<p style='text-align:center; color:red'>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>";
  }
}

window.deleteContent = async function(id, itemType){
  if(confirm("Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
    const type = targetType.value;
    let path = (type === "course") 
        ? `courses/${selectedCourseId}/content/${id}` 
        : `grades/${selectedCourseId}/${(itemType === "Ø´Ø±Ø­") ? "videos" : "content"}/${id}`;
    
    await remove(ref(db, path));
    giantAlert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­ âœ…");
    await loadContent();
  }
};

window.editContent = async function(id, itemType) {
    const newTitle = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
    if(!newTitle) return;
    const type = targetType.value;
    let path = (type === "course") 
        ? `courses/${selectedCourseId}/content/${id}` 
        : `grades/${selectedCourseId}/${(itemType === "Ø´Ø±Ø­") ? "videos" : "content"}/${id}`;

    await update(ref(db, path), { title: newTitle });
    giantAlert("ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
    await loadContent();
};

async function loadFreevids(){
  const container = document.getElementById("freevidContainer");
  const snap = await get(ref(db, "freevid"));
  container.innerHTML = "";
  if(!snap.exists()) return;
  
  Object.entries(snap.val()).forEach(([id, vid])=>{
    const div = document.createElement("div");
    div.className = "content-item";
    div.innerHTML = `
      <div class="content-info"><h3>ğŸ¥ ${vid.title}</h3></div>
      <button class="delete-btn" onclick="deleteFreevid('${id}')">Ø­Ø°Ù</button>
    `;
    container.appendChild(div);
  });
}

function setupEventListeners(){
  targetType.onchange = async () => {
    await loadCourses();
    selectedCourseId = null;
    contentContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted)">Ø§Ø®ØªØ± ÙˆØ¬Ù‡Ø© Ù„Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡Ø§</p>';
  };
  
  courseSelect.onchange = async () => {
    selectedCourseId = courseSelect.value;
    await loadContent();
  };

  contentType.onchange = () => {
    formContainer.style.display = contentType.value ? "block" : "none";
    document.querySelectorAll(".section").forEach(s => s.classList.remove("visible"));
    
    const val = contentType.value;
    if(val==="Ø´Ø±Ø­") document.getElementById("lessonSection").classList.add("visible");
    else if(val==="Ø§Ù…ØªØ­Ø§Ù†"){ 
      document.getElementById("examSection").classList.add("visible");
      document.getElementById("questionSection").classList.add("visible");
      loadTargetList("Ø§Ù…ØªØ­Ø§Ù†");
    }
    else if(val==="ÙˆØ§Ø¬Ø¨"){ 
      document.getElementById("homeworkSection").classList.add("visible");
      document.getElementById("questionSection").classList.add("visible");
      loadTargetList("ÙˆØ§Ø¬Ø¨");
    }
    else if(val==="Ù…Ø¬Ø§Ù†ÙŠ") document.getElementById("freevidSection").classList.add("visible");
  };

  document.getElementById("addLessonBtn").onclick = async () => {
    const title = document.getElementById("lessonTitle").value.trim();
    const video = document.getElementById("lessonVideo").value.trim();
    const price = document.getElementById("lessonPrice").value.trim();
    if(!selectedCourseId || !title) return giantAlert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹");
    const path = (targetType.value === "grade") ? `grades/${selectedCourseId}/videos` : `courses/${selectedCourseId}/content`;
    await push(ref(db, path), {
      type:"Ø´Ø±Ø­", title, note: document.getElementById("lessonNote").value, video,
      price: Number(price) || 0, teacher: currentUser.uid, createdAt: Date.now()
    });
    giantAlert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­ØµØ© Ø¨Ù†Ø¬Ø§Ø­ âœ…");
    ["lessonTitle", "lessonVideo", "lessonNote", "lessonPrice"].forEach(id => document.getElementById(id).value = "");
    await loadContent();
  };

  // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ§Ø¬Ø¨ Ù‡Ù†Ø§
  document.getElementById("addHomeworkBtn").onclick = async () => {
    const title = document.getElementById("homeworkTitle").value.trim();
    const desc = document.getElementById("homeworkDesc").value.trim();
    if(!selectedCourseId || !title) return giantAlert("Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø£ÙˆÙ„Ø§Ù‹");
    
    const path = (targetType.value === "grade") ? `grades/${selectedCourseId}/content` : `courses/${selectedCourseId}/content`;
    
    await push(ref(db, path), {
      type: "ÙˆØ§Ø¬Ø¨",
      title: title,
      desc: desc,
      teacher: currentUser.uid,
      createdAt: Date.now()
    });
    
    giantAlert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
    document.getElementById("homeworkTitle").value = "";
    document.getElementById("homeworkDesc").value = "";
    await loadContent();
    await loadTargetList("ÙˆØ§Ø¬Ø¨");
  };

  document.getElementById("addFreevidBtn").onclick = async () => {
    const title = document.getElementById("freevidTitle").value.trim();
    const link = document.getElementById("freevidLink").value.trim();
    if(!title || !link) return giantAlert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    await push(ref(db,"freevid"),{title, link, createdAt: Date.now()});
    giantAlert("ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…");
    document.getElementById("freevidTitle").value = ""; 
    document.getElementById("freevidLink").value = "";
    await loadFreevids();
  };

  document.getElementById("addExamBtn").onclick = async () => {
    const title = document.getElementById("examTitle").value.trim();
    if(!selectedCourseId || !title) return giantAlert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    const path = targetType.value === "course" ? "courses" : "grades";
    await push(ref(db, `${path}/${selectedCourseId}/content`), {
      type:"Ø§Ù…ØªØ­Ø§Ù†", title, desc: document.getElementById("examDesc").value, 
      time: document.getElementById("examTime").value, teacher: currentUser.uid, createdAt: Date.now()
    });
    giantAlert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† âœ…");
    await loadTargetList("Ø§Ù…ØªØ­Ø§Ù†");
    await loadContent();
  };

  document.getElementById("addQuestionBtn").onclick = async () => {
    const targetId = targetSelect.value;
    const question = document.getElementById("questionText").value.trim();
    if(!targetId || !question) return giantAlert("Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù ÙˆØ§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„");
    const tPath = targetType.value === "course" ? "courses" : "grades";
    const refQ = push(ref(db, `${tPath}/${selectedCourseId}/content/${targetId}/questions`));
    const type = document.getElementById("questionType").value;
    const data = { type, question, correct: document.getElementById("correct").value };
    if(type === "Ø§Ø®ØªÙŠØ§Ø±ÙŠ") {
        data.opt1 = document.getElementById("opt1").value;
        data.opt2 = document.getElementById("opt2").value;
        data.opt3 = document.getElementById("opt3").value;
    }
    await set(refQ, data);
    giantAlert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ âœ…");
    ["questionText", "opt1", "opt2", "opt3", "correct"].forEach(id => document.getElementById(id).value = "");
  };
}

async function loadTargetList(type){
  targetSelect.innerHTML='<option value="">-- Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„... --</option>';
  const tPath = targetType.value === "course" ? "courses" : "grades";
  const snap = await get(ref(db,`${tPath}/${selectedCourseId}/content`));
  targetSelect.innerHTML='<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù --</option>';
  if(snap.exists()){
    Object.entries(snap.val()).forEach(([id,item])=>{
      if(item.type === type && item.teacher === currentUser.uid){
        const opt = document.createElement("option");
        opt.value = id; opt.textContent = item.title;
        targetSelect.appendChild(opt);
      }
    });
  }
}

init();
</script>
</body>
</html>