<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† | THE GIANT</title>

  <style>
    :root {
      --bg: #0b0f19;
      --card: #111827;
      --muted: #ccc;
      --accent: #00b2ff;
      --ok: #00b258;
      --danger: #e63946;
    }

    body {
      margin: 0;
      font-family: "Cairo", sans-serif;
      background: var(--bg);
      color: #fff;
      padding: 20px;
    }

    /* ğŸ”¥ Ø§Ù„ØµÙØ­Ø© Ù…Ø®ÙÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ø­Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ */
    #pageContent { display: none; }

    h1 {
      text-align: center;
      color: var(--accent);
      margin-bottom: 1.5rem;
    }

    .card {
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      max-width: 700px;
      margin: 0 auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }

    label {
      display: block;
      margin-top: 10px;
      color: var(--muted);
    }

    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: #1e2636;
      color: #fff;
      margin-top: 5px;
    }

    button {
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
    }

    .btn-add {
      background: var(--ok);
      color: #fff;
      margin-top: 15px;
      width: 100%;
    }

    .btn-save {
      background: #0077ff;
      color: white;
      margin-top: 15px;
      width: 100%;
      display: none;
    }

    .btn-danger {
      background: var(--danger);
      color: #fff;
      margin-top: 10px;
    }

    .teacher {
      background: #151a23;
      padding: 12px;
      border-radius: 8px;
      margin-top: 10px;
    }

    .teacher .info {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .muted {
      color: var(--muted);
      font-size: 14px;
    }

    #backBtn {
      background: var(--accent);
      color: #000;
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
      border: none;
      position: fixed;
      top: 15px;
      left: 15px;
    }

    #searchInput {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: #1e2636;
      color: #fff;
    }

    #customAlert {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #111827;
      color: #fff;
      padding: 25px 30px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,178,255,0.4);
      text-align: center;
      z-index: 9999;
      animation: fadeIn 0.4s ease;
      width: 85%;
      max-width: 360px;
    }

    #customAlert h3 {
      color: #00b2ff;
      margin-bottom: 12px;
    }

    #customAlert button {
      margin-top: 10px;
      background: #00b2ff;
      border: none;
      color: white;
      padding: 10px 30px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1rem;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

<!-- ğŸ” Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ -->
<div id="pageContent">

  <button id="backBtn">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
  <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†</h1>

  <div class="card">
    <label>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ±</label>
    <input id="searchInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ± Ù„Ù„Ø¨Ø­Ø«">

    <label>ğŸ‘¨â€ğŸ« Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ±</label>
    <input id="t_name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ±" />

    <label>ğŸ“˜ Ø§Ù„ØªØ®ØµØµ</label>
    <input id="t_subject" placeholder="Ù…Ø«Ø§Ù„: Ø±ÙŠØ§Ø¶ÙŠØ§ØªØŒ Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©..." />

    <label>ğŸ§‘â€ğŸ’¼ Ø§Ø³Ù… Ø§Ù„Ø³ÙƒØ±ØªÙŠØ±Ø©</label>
    <input id="t_secretary" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³ÙƒØ±ØªÙŠØ±Ø©" />

    <label>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒØ±ØªÙŠØ±Ø©</label>
    <input id="t_secretary_phone" type="number" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒØ±ØªÙŠØ±Ø©" />

    <label>ğŸ“ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
    <select id="t_grade" multiple size="12">
      <option value="1prim">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
      <option value="2prim">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
      <option value="3prim">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
      <option value="4prim">Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
      <option value="5prim">Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
      <option value="6prim">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
      <option value="1prep">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
      <option value="2prep">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
      <option value="3prep">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
      <option value="1sec">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
      <option value="2sec">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
      <option value="3sec">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
    </select>

    <label>ğŸ–¼ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ±</label>
    <input id="t_photoUrl" placeholder="Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />

    <button id="addTeacherBtn" class="btn-add">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ±</button>
    <button id="saveEditBtn" class="btn-save">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>

    <div id="teachersList"></div>
  </div>
</div>

<!-- Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
<div id="customAlert">
  <h3>THE GIANT says ğŸ’¬</h3>
  <p id="alertMessage"></p>
  <button onclick="closeAlert()">ØªÙ…Ø§Ù…</button>
</div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getDatabase, ref, push, set, get, remove, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDW80ZbwOB7QHHW76kSL9cqlzMoyPFZ7nI",
    authDomain: "ylearn-fe1fa.firebaseapp.com",
    databaseURL: "https://ylearn-fe1fa-default-rtdb.firebaseio.com",
    projectId: "ylearn-fe1fa",
    storageBucket: "ylearn-fe1fa.appspot.com",
    messagingSenderId: "1092852055944",
    appId: "1:1092852055944:web:85c3df7cf4c0cbcdca043d"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const ADMIN_UID = "lSpi591awfQMcRFU62CAM3108Hu1";
  let editMode = false;
  let editID = null;
  let allTeachers = {};

  // Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ù…ÙˆØ² Ø¥Ù„Ù‰ Ø£Ø³Ù…Ø§Ø¡ Ø¹Ø±Ø¨ÙŠØ©
  const gradeNames = {
    "1prim": "Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "2prim": "Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "3prim": "Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ",
    "4prim": "Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "5prim": "Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "6prim": "Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ",
    "1prep": "Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "2prep": "Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "3prep": "Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ",
    "1sec": "Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ", "2sec": "Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ", "3sec": "Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ"
  };

  window.showAlert = function (msg) {
    document.getElementById("alertMessage").textContent = msg;
    document.getElementById("customAlert").style.display = "block";
  };
  window.closeAlert = function () {
    document.getElementById("customAlert").style.display = "none";
  };

  onAuthStateChanged(auth, (user) => {
    if (!user) { window.location.href = "index.html"; return; }
    if (user.uid !== ADMIN_UID) {
      document.body.innerHTML = "<h2 style='text-align:center;margin-top:50px;color:red'>ğŸš« ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø¯Ø®ÙˆÙ„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©</h2>";
      return;
    }
    document.getElementById("pageContent").style.display = "block";
    loadTeachers();
  });

  async function loadTeachers() {
    const teachersList = document.getElementById("teachersList");
    teachersList.innerHTML = '<p class="muted">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
    const snapshot = await get(ref(db, 'teachers'));
    if (!snapshot.exists()) {
      teachersList.innerHTML = '<p class="muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¯Ø±Ø³ÙŠÙ† Ø¨Ø¹Ø¯</p>';
      allTeachers = {};
      return;
    }
    allTeachers = snapshot.val();
    displayTeachers(allTeachers);
  }

  function displayTeachers(data) {
    const teachersList = document.getElementById("teachersList");
    teachersList.innerHTML = '';
    Object.entries(data).forEach(([id, teacher]) => {
      const div = document.createElement('div');
      div.className = 'teacher';
      // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„ØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø±Ù…Ø²
      const readableGrade = gradeNames[teacher.grade] || teacher.grade;
      
      div.innerHTML = `
        <div class="info">
          <strong>${teacher.name}</strong>
          <span style="color: var(--accent); font-size: 0.8rem;">${readableGrade}</span>
        </div>
        <div class="muted">
          ğŸ“š Ø§Ù„ØªØ®ØµØµ: ${teacher.subject}<br>
          ğŸ§‘â€ğŸ’¼ Ø³ÙƒØ±ØªØ§Ø±ÙŠØ©: ${teacher.secretary} | ğŸ“ ${teacher.secretaryPhone}
        </div>
        ${teacher.photoUrl ? `<img src="${teacher.photoUrl}" style="width:100%; height:150px; object-fit:cover; margin-top:8px; border-radius:10px; border: 1px solid #333;">` : ''}
        <div style="display:flex; gap:10px;">
          <button style="background:#0077ff; color:white; margin-top:10px; flex:1;" onclick="editTeacher('${id}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn-danger" style="flex:1;" onclick="deleteTeacher('${id}')">ğŸ—‘ Ø­Ø°Ù</button>
        </div>
      `;
      teachersList.appendChild(div);
    });
  }

  // Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø±Ø³ (ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©)
  document.getElementById("addTeacherBtn").addEventListener('click', async () => {
    const name = t_name.value.trim();
    const subject = t_subject.value.trim();
    const secretary = t_secretary.value.trim();
    const secretaryPhone = t_secretary_phone.value.trim();
    const gradeOptions = Array.from(t_grade.selectedOptions).map(o => o.value);
    const photoUrl = t_photoUrl.value.trim();

    if (!name || !subject || !secretary || !secretaryPhone || gradeOptions.length === 0) {
      return showAlert("âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© ÙƒØ§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ø®ØªÙŠØ§Ø± ØµÙ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
    }

    // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ ØµÙ Ø¯Ø±Ø§Ø³ÙŠ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡
    const promises = gradeOptions.map(grade => {
      const newRef = push(ref(db, 'teachers'));
      return set(newRef, { name, subject, secretary, secretaryPhone, grade, photoUrl });
    });

    await Promise.all(promises);
    clearInputs();
    showAlert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯Ø±Ø³ Ù„ÙƒØ§ÙØ© Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©");
    loadTeachers();
  });

  window.editTeacher = function (id) {
    const t = allTeachers[id];
    editMode = true;
    editID = id;

    t_name.value = t.name;
    t_subject.value = t.subject;
    t_secretary.value = t.secretary;
    t_secretary_phone.value = t.secretaryPhone;
    t_photoUrl.value = t.photoUrl;

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    Array.from(t_grade.options).forEach(opt => opt.selected = opt.value === t.grade);

    document.getElementById("addTeacherBtn").style.display = 'none';
    document.getElementById("saveEditBtn").style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  document.getElementById("saveEditBtn").addEventListener('click', async () => {
    const name = t_name.value.trim();
    const subject = t_subject.value.trim();
    const secretary = t_secretary.value.trim();
    const secretaryPhone = t_secretary_phone.value.trim();
    const grade = t_grade.value; // ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù†Ø£Ø®Ø° Ø£ÙˆÙ„ Ù‚ÙŠÙ…Ø© Ù…Ø®ØªØ§Ø±Ø© ÙÙ‚Ø·
    const photoUrl = t_photoUrl.value.trim();

    await update(ref(db, 'teachers/' + editID), {
      name, subject, secretary, secretaryPhone, grade, photoUrl
    });

    editMode = false;
    editID = null;
    document.getElementById("saveEditBtn").style.display = 'none';
    document.getElementById("addTeacherBtn").style.display = 'block';
    
    clearInputs();
    showAlert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³");
    loadTeachers();
  });

  window.deleteTeacher = async (id) => {
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¯Ø±Ø³ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) return;
    await remove(ref(db, 'teachers/' + id));
    showAlert("ğŸ—‘ ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­");
    loadTeachers();
  };

  function clearInputs() {
    t_name.value = ''; t_subject.value = ''; t_secretary.value = '';
    t_secretary_phone.value = ''; t_photoUrl.value = '';
    Array.from(t_grade.options).forEach(o => o.selected = false);
  }

  document.getElementById("searchInput").addEventListener('input', (e) => {
    const q = e.target.value.trim().toLowerCase();
    const filtered = Object.fromEntries(
      Object.entries(allTeachers).filter(([id, t]) =>
        t.name.toLowerCase().includes(q) || t.subject.toLowerCase().includes(q)
      )
    );
    displayTeachers(filtered);
  });

  document.getElementById("backBtn").addEventListener('click', () => {
    window.location.href = "admin.html";
  });
</script>
</body>
</html>