<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE GIANT AI - Ù…Ø­Ø±Ùƒ Qwen Ø§Ù„Ø¬Ø¨Ø§Ø±</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { margin: 0; font-family: 'Cairo', sans-serif; background: linear-gradient(135deg, #0b0f19, #0f172a); color: #fff; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        #chat-interface { width: 95%; max-width: 600px; height: 92vh; background: #111827; border-radius: 22px; border: 2px solid #7c3aed; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,.6); position: relative; }
        #chat-header { background: linear-gradient(90deg, #7c3aed, #5b21b6); padding: 15px; text-align: center; font-size: 1.2rem; font-weight: 700; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .header-btns { display: flex; gap: 8px; }
        #back-btn, #clear-btn { background: rgba(255, 255, 255, .15); border: none; color: #fff; padding: 6px 12px; border-radius: 15px; cursor: pointer; font-size: .8rem; transition: .3s; }
        #chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 14px; scroll-behavior: smooth; }
        .message { max-width: 88%; padding: 12px 16px; border-radius: 18px; line-height: 1.6; animation: fadeUp .3s ease; word-wrap: break-word; position: relative; font-size: 0.95rem; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .user-message { background: #7c3aed; align-self: flex-end; border-bottom-left-radius: 4px; color: white; }
        .bot-message { background: #1e293b; align-self: flex-start; border-bottom-right-radius: 4px; border-right: 4px solid #a78bfa; }
        .copy-btn { position: absolute; top: 5px; left: 5px; background: rgba(255,255,255,0.1); border: none; color: #a78bfa; font-size: 0.7rem; cursor: pointer; padding: 2px 5px; border-radius: 5px; opacity: 0.6; }
        .copy-btn:hover { opacity: 1; background: rgba(255,255,255,0.2); }
        .support-footer { background: #0f172a; color: #a78bfa; padding: 8px; text-align: center; font-size: 0.75rem; border-top: 1px solid #1e293b; }
        .typing-indicator { font-size: 0.8rem; color: #a78bfa; align-self: flex-start; padding: 10px; font-style: italic; display: none; }
        #input-area { display: flex; padding: 12px; border-top: 1px solid #1e293b; background: #0f172a; gap: 8px; }
        #chat-input { flex: 1; background: #020617; border: 1px solid #1e293b; color: #fff; padding: 10px; border-radius: 10px; outline: none; }
        #send, #voice-btn { background: #7c3aed; border: none; color: #fff; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-weight: 700; transition: 0.3s; }
        #voice-btn.active { background: #ff4b2b; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div id="chat-interface">
    <div id="chat-header">
        <span>ğŸš€ THE GIANT AI</span>
        <div class="header-btns">
            <button id="clear-btn">Ù…Ø³Ø­</button>
            <button id="back-btn" onclick="window.history.back()">Ø±Ø¬ÙˆØ¹</button>
        </div>
    </div>
    <div id="chat-messages"></div>
    <div id="typing" class="typing-indicator">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ‚ Ø¹Ø¨Ø± Ù…Ø­Ø±Ùƒ Qwen 2.5...</div>
    <div class="support-footer">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠğŸ“: 01221015966</div>
    <div id="input-area">
        <button id="voice-btn">ğŸ¤</button>
        <input id="chat-input" placeholder="Ø§Ø³Ø£Ù„ ÙÙŠ Ø£ÙŠ Ù…Ø§Ø¯Ø© Ø£Ùˆ Ø¹Ù† Ø§Ù„Ù…Ù†ØµØ©...">
        <button id="send">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<script type="module">
    const CONFIG = {
        API_KEY: "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",
        MODEL: "Qwen/Qwen2.5-72B-Instruct"
    };

    const API_URL = `https://api-inference.huggingface.co/models/${CONFIG.MODEL}`;
    const notificationSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3');

    const SYSTEM_INSTRUCTIONS = `
    Ø£Ù†Øª Ø§Ù„Ø¢Ù† "The Giant AI" Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚ Ù„Ù…Ù†ØµØ© Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©.
    Ø£Ù†Øª ØªØ³ØªØ®Ø¯Ù… Ù…Ø­Ø±Ùƒ Qwen 2.5 72B Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© Ù„ØºÙˆÙŠØ© ÙˆØ¹Ù„Ù…ÙŠØ© ÙØ§Ø¦Ù‚Ø©.
    Ø§Ù„Ù…Ø·ÙˆØ±: ÙŠØ§Ø³ÙŠÙ† ÙŠØ§Ø³Ø±.
    Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„Ù†Ø­Ùˆ Ø§Ù„Ø¹Ø±Ø¨ÙŠ (Ø¯Ù‚Ø© Ù…Ø·Ù„Ù‚Ø©): Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ù„ØºÙˆÙŠØŒ Ø§Ù„ØªØ²Ù… Ø¨Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù†Ø­Ùˆ Ø§Ù„ÙØµØ­Ù‰.
    Ø«Ø§Ù†ÙŠØ§Ù‹: Ø®Ø¨ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¯: Ø£Ø¬Ø¨ Ø¨Ø¯Ù‚Ø© ÙÙŠ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ØŒ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ØŒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§ØªØŒ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®.
    Ø«Ø§Ù„Ø«Ø§Ù‹: Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ©: Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª: dashboard.html | Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ: freevid.html | Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ: profile.html
    Ø±Ø§Ø¨Ø¹Ø§Ù‹: Ø§Ù„Ø£Ø³Ù„ÙˆØ¨: Ù†Ø§Ø¯Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù€ "ÙŠØ§ Ø¹Ù…Ù„Ø§Ù‚".
    `;

    const chatMessages = document.getElementById("chat-messages");
    const chatInput = document.getElementById("chat-input");
    const sendBtn = document.getElementById("send");
    const voiceBtn = document.getElementById("voice-btn");
    const typingIndicator = document.getElementById("typing");

    let isTyping = false;

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.lang = 'ar-SA';
        recognition.interimResults = false;

        voiceBtn.onclick = () => {
            try {
                recognition.start();
                voiceBtn.classList.add("active");
                voiceBtn.innerText = "ğŸ›‘";
            } catch (e) { recognition.stop(); }
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            chatInput.value = transcript;
            voiceBtn.classList.remove("active");
            voiceBtn.innerText = "ğŸ¤";
            handleSend(); // Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª
        };

        recognition.onspeechend = () => {
            recognition.stop();
            voiceBtn.classList.remove("active");
            voiceBtn.innerText = "ğŸ¤";
        };

        recognition.onerror = () => {
            voiceBtn.classList.remove("active");
            voiceBtn.innerText = "ğŸ¤";
        };
    } else {
        voiceBtn.onclick = () => alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…Ø§ÙŠÙƒ ÙŠØ§ Ø¹Ù…Ù„Ø§Ù‚.");
    }

    function addMessage(text, type, save = true) {
        const div = document.createElement("div");
        div.className = `message ${type}-message`;
        if (type === 'bot') {
            div.innerHTML = `<button class="copy-btn" onclick="copyText(this)">Ù†Ø³Ø®</button><div class="markdown-content">${marked.parse(text)}</div>`;
        } else {
            div.innerText = text;
        }
        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        if (save) saveChat();
    }

    async function typeWriterEffect(text) {
        isTyping = true;
        sendBtn.innerText = "Ø¥ÙŠÙ‚Ø§Ù";
        notificationSound.play().catch(e => {});
        const div = document.createElement("div");
        div.className = `message bot-message`;
        div.innerHTML = `<button class="copy-btn" onclick="copyText(this)">Ù†Ø³Ø®</button><div class="markdown-content"></div>`;
        chatMessages.appendChild(div);
        const contentDiv = div.querySelector('.markdown-content');
        
        const words = text.split(" ");
        let currentText = "";
        for (let i = 0; i < words.length; i++) {
            if (!isTyping) break;
            currentText += words[i] + " ";
            contentDiv.innerHTML = marked.parse(currentText);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            await new Promise(r => setTimeout(r, 25));
        }
        isTyping = false;
        sendBtn.innerText = "Ø¥Ø±Ø³Ø§Ù„";
        saveChat();
    }

    async function askAI(prompt) {
        typingIndicator.style.display = "block";
        try {
            const response = await fetch(API_URL, {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${CONFIG.API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    inputs: `<|im_start|>system\n${SYSTEM_INSTRUCTIONS}<|im_end|>\n<|im_start|>user\n${prompt}<|im_end|>\n<|im_start|>assistant`,
                    parameters: { max_new_tokens: 1024, temperature: 0.1, return_full_text: false }
                })
            });
            
            const data = await response.json();
            typingIndicator.style.display = "none";
            let aiResponse = Array.isArray(data) ? data[0].generated_text.trim() : "ÙŠØ§ Ø¹Ù…Ù„Ø§Ù‚ØŒ Ø§Ù„Ù…Ø­Ø±Ùƒ Ù…Ø´ØºÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹. Ø­Ø§ÙˆÙ„ Ø«Ø§Ù†ÙŠØ©.";
            await typeWriterEffect(aiResponse);
        } catch (e) {
            typingIndicator.style.display = "none";
            addMessage("ÙŠØ§ Ø¹Ù…Ù„Ø§Ù‚ØŒ Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.", "bot");
        }
    }

    function handleSend() {
        const text = chatInput.value.trim();
        if (isTyping) { isTyping = false; return; }
        if (!text) return;
        addMessage(text, "user");
        chatInput.value = "";
        askAI(text);
    }

    sendBtn.onclick = handleSend;
    chatInput.onkeypress = (e) => { if (e.key === 'Enter') handleSend(); };
    
    function saveChat() {
        const msgs = [];
        document.querySelectorAll('.message').forEach(m => {
            const content = m.querySelector('.markdown-content') ? m.querySelector('.markdown-content').innerText : m.innerText;
            msgs.push({ text: content.replace('Ù†Ø³Ø®', '').trim(), type: m.classList.contains('user-message') ? 'user' : 'bot' });
        });
        localStorage.setItem('giant_qwen_history', JSON.stringify(msgs));
    }

    function loadChat() {
        const history = JSON.parse(localStorage.getItem('giant_qwen_history'));
        if (history) { history.forEach(m => addMessage(m.text, m.type, false)); }
        else { addMessage("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¹Ù…Ù„Ø§Ù‚. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ", "bot", false); }
    }

    document.getElementById("clear-btn").onclick = () => {
        localStorage.removeItem('giant_qwen_history');
        location.reload();
    };

    window.copyText = (btn) => {
        const text = btn.parentElement.querySelector('.markdown-content').innerText;
        navigator.clipboard.writeText(text);
        btn.innerText = "ØªÙ…!";
        setTimeout(() => btn.innerText = "Ù†Ø³Ø®", 2000);
    };

    loadChat();
</script>
</body>
</html>
