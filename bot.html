<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE GIANT - Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { margin: 0; font-family: 'Cairo', sans-serif; background: linear-gradient(135deg, #0b0f19, #0f172a); color: #fff; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        #chat-interface { width: 95%; max-width: 600px; height: 92vh; background: #111827; border-radius: 22px; border: 2px solid #00b2ff; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,.6); position: relative; }
        #chat-header { background: linear-gradient(90deg, #00b2ff, #008bcc); padding: 15px; text-align: center; font-size: 1.2rem; font-weight: 700; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .header-btns { display: flex; gap: 8px; }
        #back-btn, #clear-btn { background: rgba(255, 255, 255, .15); border: none; color: #fff; padding: 6px 12px; border-radius: 15px; cursor: pointer; font-size: .8rem; transition: .3s; }
        
        #chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 14px; scroll-behavior: smooth; }
        .message { max-width: 88%; padding: 12px 16px; border-radius: 18px; line-height: 1.6; animation: fadeUp .3s ease; word-wrap: break-word; position: relative; font-size: 0.95rem; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .user-message { background: #00b2ff; align-self: flex-end; border-bottom-left-radius: 4px; color: white; }
        .bot-message { background: #1e293b; align-self: flex-start; border-bottom-right-radius: 4px; border-right: 4px solid #7ee8fa; }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù€ Markdown Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .markdown-content p { margin: 5px 0; }
        .markdown-content ul, .markdown-content ol { padding-right: 25px; margin: 5px 0; }
        .markdown-content li { margin-bottom: 4px; }
        .markdown-content a { color: #7ee8fa; text-decoration: underline; font-weight: bold; }
        
        .copy-btn { position: absolute; top: 5px; left: 5px; background: rgba(255,255,255,0.1); border: none; color: #7ee8fa; font-size: 0.7rem; cursor: pointer; padding: 2px 5px; border-radius: 5px; opacity: 0.6; }
        .copy-btn:hover { opacity: 1; background: rgba(255,255,255,0.2); }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
        #quick-actions { display: flex; gap: 8px; padding: 10px; overflow-x: auto; background: #0f172a; border-top: 1px solid #1e293b; scrollbar-width: none; }
        #quick-actions::-webkit-scrollbar { display: none; }
        .action-btn { background: #1e293b; border: 1px solid #00b2ff; color: #7ee8fa; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; white-space: nowrap; cursor: pointer; transition: 0.3s; }
        .action-btn:hover { background: #00b2ff; color: #fff; }

        .support-footer { background: #0f172a; color: #7ee8fa; padding: 8px; text-align: center; font-size: 0.75rem; border-top: 1px solid #1e293b; }
        .typing-indicator { font-size: 0.8rem; color: #7ee8fa; align-self: flex-start; padding: 10px; font-style: italic; display: none; }
        
        #input-area { display: flex; padding: 12px; border-top: 1px solid #1e293b; background: #0f172a; gap: 8px; }
        #chat-input { flex: 1; background: #020617; border: 1px solid #1e293b; color: #fff; padding: 10px; border-radius: 10px; outline: none; transition: 0.3s; }
        #chat-input:focus { border-color: #00b2ff; box-shadow: 0 0 5px rgba(0,178,255,0.3); }
        #send, #voice-btn { background: #00b2ff; border: none; color: #fff; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-weight: 700; transition: 0.3s; }
        #send:hover { background: #008bcc; }
        #voice-btn.active { background: #ef4444; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div id="chat-interface">
    <div id="chat-header">
        <span>Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø© Ø§Ù„Ø°ÙƒÙŠ</span>
        <div class="header-btns">
            <button id="clear-btn">Ù…Ø³Ø­</button>
            <button id="back-btn" onclick="window.history.back()">Ø±Ø¬ÙˆØ¹</button>
        </div>
    </div>
    
    <div id="chat-messages"></div>
    <div id="typing" class="typing-indicator">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ± ÙˆØ§Ù„Ø±Ø¯...</div>

    <div id="quick-actions">
        <button class="action-btn" onclick="quickSearch('ÙƒÙŠÙÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        <button class="action-btn" onclick="quickSearch('Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„')">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
        <button class="action-btn" onclick="quickSearch('ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ')">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</button>
        <button class="action-btn" onclick="quickSearch('Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ')">Ø­ØµØµ Ù…Ø¬Ø§Ù†ÙŠØ©</button>
    </div>

    <div class="support-footer">
        Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±: 01221015966 
        | Ù‚Ø¯ ÙŠØ®Ø·Ø¦ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø­Ø¯ÙŠØ«Ù‡
    </div>
    
    <div id="input-area">
        <button id="voice-btn" title="ØªØ­Ø¯Ø« Ø§Ù„Ø¢Ù†">ğŸ¤</button>
        <input id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§ ÙŠØ§ Ø¹Ù…Ù„Ø§Ù‚...">
        <button id="send">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<script type="module">
    const CONFIG = {
        API_KEY: "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",
        MODEL: "llama-3.1-8b-instant"
    };

    const API_URL = "https://api.groq.com/openai/v1/chat/completions";

    const SYSTEM_INSTRUCTIONS = `
    Ø£Ù†Øª Ø§Ø³Ù…Ùƒ "Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©" (The Giant Assistant). Ù…Ù‡Ù…ØªÙƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù‡ÙŠ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Ù…Ù†ØµØ© Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ: https://thegiant10.com

    1. Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆØ§Ù„Ø£Ø³Ù„ÙˆØ¨ (Ø£Ù‡Ù… Ø´ÙŠØ¡):
    - Ø£Ù†Øª Ø°ÙƒÙŠ Ø¬Ø¯Ø§Ù‹ØŒ ÙˆØ¯ÙˆØ¯ØŒ ÙˆÙ…Ù„Ù‡Ù… Ù„Ù„Ø·Ù„Ø§Ø¨.
    - **Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø®Ø§Ø±Ø¬ÙŠØ©:** Ø£Ù†Øª Ù„Ø§ ØªØ¬ÙŠØ¨ Ø¹Ù„Ù‰ Ø£ÙŠ Ø£Ø³Ø¦Ù„Ø© Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ù…Ù†ØµØ© "Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©" Ø£Ùˆ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø­ØµØµ. Ø¥Ø°Ø§ Ø³Ø£Ù„Ùƒ Ø£Ø­Ø¯ Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø¯Ø±Ø§Ø³ÙŠØ§Ù‹ Ø£Ùˆ Ø¹Ù„Ù…ÙŠØ§Ù‹ Ø¹Ø§Ù…Ø§Ù‹ (Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ù†ØµØ©)ØŒ Ø§Ø¹ØªØ°Ø± Ø¨Ù„Ø¨Ø§Ù‚Ø© ÙˆØ£Ø®Ø¨Ø±Ù‡ Ø£Ù†Ùƒ Ù…Ø¨Ø±Ù…Ø¬ ÙÙ‚Ø· Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†ØµØ© ÙˆØ®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©.
    - Ù„ØºØ© Ø§Ù„Ø­ÙˆØ§Ø± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† "Ø§Ù„Ø¹Ø§Ù…ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ© Ø§Ù„Ù…Ù‡Ø°Ø¨Ø©".
    - ØªØ°ÙƒØ± Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ù†Ø§Ø¯Ø§ØªÙ‡Ù… Ø¨ÙƒÙ„Ù…Ø© "ÙŠØ§ Ø¹Ù…Ù„Ø§Ù‚" Ø£Ùˆ "ÙŠØ§ Ø¨Ø·Ù„".

    2. Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù…Ù†ØµØ©:
    - Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ Ù‡Ùˆ thegiant10.com. ÙƒÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù…ØªØ§Ø­Ø© Ù…Ù† Ø®Ù„Ø§Ù„Ù‡ ÙÙ‚Ø· ÙˆÙ„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø£Ø®Ø±Ù‰ Ø­Ø§Ù„ÙŠØ§Ù‹.

    3. Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù‡Ø§Ù…Ø© Ù„Ù„Ù…Ù†ØµØ© (ÙŠØ¬Ø¨ ØªÙ‚Ø¯ÙŠÙ…Ù‡Ø§ Ø¨ÙˆØ¶ÙˆØ­):
    - Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: https://thegiant10.com/index.html
    - Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨: https://thegiant10.com/register.html
    - ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„: https://thegiant10.com/login.html
    - Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨: https://thegiant10.com/dashboard.html
    - Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ: https://thegiant10.com/freevid.html
    - Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ: https://thegiant10.com/myprofile.html
    - ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§: https://thegiant10.com/tawasal.html
    - Ù‚ÙŠÙ‘Ù…Ù†Ø§: https://thegiant10.com/taqeem.html
    * ØªÙ†Ø¨ÙŠÙ‡: Ø£ÙŠ Ø±Ø§Ø¨Ø· Ø¢Ø®Ø± Ø®Ø§Ø±Ø¬ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚ØŒ Ù‚Ù„ Ù„Ù„Ø·Ø§Ù„Ø¨ Ø£Ù†Ù‡ Ù‚Ø¯ ÙŠÙƒÙˆÙ† ØºÙŠØ± Ø¢Ù…Ù† ÙˆØ£Ù† Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ Ø§Ù„ÙˆØ­ÙŠØ¯.

    4. Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰:
    - Ø§Ø³Ø£Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¹Ù† Ø±Ù‚Ù… Ù‡Ø§ØªÙÙ‡ Ø§Ù„Ù…Ø³Ø¬Ù„ Ø¨Ù‡ ÙÙŠ "Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©".
    - Ø·Ù…Ø¦Ù†Ù‡ Ø¨Ø£Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø³ØªØ­Ù„ ÙÙˆØ±Ø§Ù‹.
    - ÙˆØ¬Ù‡Ù‡ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ (ÙŠØ§Ø³ÙŠÙ† Ù…Ù†ØµÙˆØ±) Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø£Ùˆ Ø§Ù„Ø§ØªØµØ§Ù„.

    5. Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ù‡Ù†ÙŠØ©:
    - Ù„Ø§ ØªØ°ÙƒØ± Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ ØªÙ‚Ù†ÙŠØ© Ø¹Ù† Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø°ÙŠ ØªØ¹Ù…Ù„ Ø¨Ù‡ Ø£Ùˆ ÙƒÙŠÙ ØªÙ… Ø¨Ø±Ù…Ø¬ØªÙƒ.

    6. Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ:
    - Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬: yassenmansor685@gamil.com | ÙˆØ§ØªØ³Ø§Ø¨: 01221015966.
`;

    const chatMessages = document.getElementById("chat-messages");
    const chatInput = document.getElementById("chat-input");
    const sendBtn = document.getElementById("send");
    const typingIndicator = document.getElementById("typing");

    let chatHistory = []; 
    let isTyping = false;

    // ØªÙ‡ÙŠØ¦Ø© Marked Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
    marked.setOptions({ gfm: true, breaks: true });

    function addMessage(text, type, save = true) {
        const div = document.createElement("div");
        div.className = `message ${type}-message`;
        if (type === 'bot') {
            div.innerHTML = `<button class="copy-btn" onclick="copyText(this)">Ù†Ø³Ø®</button><div class="markdown-content">${marked.parse(text)}</div>`;
        } else {
            div.innerText = text;
        }
        chatMessages.appendChild(div);
        autoScroll();
        if (save) saveChat();
    }

    async function typeWriterEffect(text) {
        isTyping = true;
        sendBtn.innerText = "Ø¥ÙŠÙ‚Ø§Ù";
        const div = document.createElement("div");
        div.className = `message bot-message`;
        div.innerHTML = `<button class="copy-btn" onclick="copyText(this)">Ù†Ø³Ø®</button><div class="markdown-content"></div>`;
        chatMessages.appendChild(div);
        const contentDiv = div.querySelector('.markdown-content');
        
        const words = text.split(" ");
        let currentText = "";
        for (let i = 0; i < words.length; i++) {
            if (!isTyping) break;
            currentText += words[i] + " ";
            contentDiv.innerHTML = marked.parse(currentText);
            autoScroll();
            await new Promise(r => setTimeout(r, 45));
        }
        isTyping = false;
        sendBtn.innerText = "Ø¥Ø±Ø³Ø§Ù„";
        saveChat();
    }

    function autoScroll() { chatMessages.scrollTop = chatMessages.scrollHeight; }

    function saveChat() {
        const msgs = [];
        document.querySelectorAll('.message').forEach(m => {
            const content = m.querySelector('.markdown-content') ? m.querySelector('.markdown-content').innerText : m.innerText;
            msgs.push({ text: content.replace('Ù†Ø³Ø®', '').trim(), type: m.classList.contains('user-message') ? 'user' : 'bot' });
        });
        localStorage.setItem('giant_chat_history', JSON.stringify(msgs.slice(-10))); // Ø­ÙØ¸ Ø¢Ø®Ø± 10 ÙÙ‚Ø· Ù„Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡
    }

    function loadChat() {
        const history = JSON.parse(localStorage.getItem('giant_chat_history'));
        if (history && history.length > 0) {
            history.forEach(m => {
                addMessage(m.text, m.type, false);
                chatHistory.push({ role: m.type === 'user' ? 'user' : 'assistant', content: m.text });
            });
        } else {
            addMessage("Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ ÙŠØ§ Ø¹Ù…Ù„Ø§Ù‚ ÙÙŠ Ù…Ù†ØµØ© THE GIANT 10. Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠØŒ Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠØŒ Ø£Ùˆ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø­ØµØµÙƒ. Ø§Ø¤Ù…Ø±Ù†ÙŠ ÙŠØ§ Ø¨Ø·Ù„!", "bot", false);
        }
    }

    window.copyText = (btn) => {
        const text = btn.parentElement.querySelector('.markdown-content').innerText;
        navigator.clipboard.writeText(text);
        btn.innerText = "ØªÙ…!";
        setTimeout(() => btn.innerText = "Ù†Ø³Ø®", 2000);
    };

    window.quickSearch = (text) => {
        chatInput.value = text;
        handleSend();
    };

    async function askAI(prompt) {
        typingIndicator.style.display = "block";
        chatHistory.push({ role: "user", content: prompt });
        
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©) Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù€ Tokens
        if (chatHistory.length > 12) chatHistory = chatHistory.slice(-12);

        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 15000); // Ù…Ù‡Ù„Ø© 15 Ø«Ø§Ù†ÙŠØ©

            const response = await fetch(API_URL, {
                method: "POST",
                headers: { "Authorization": `Bearer ${CONFIG.API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: CONFIG.MODEL,
                    messages: [{ role: "system", content: SYSTEM_INSTRUCTIONS }, ...chatHistory],
                    temperature: 0.3,
                    max_tokens: 500
                }),
                signal: controller.signal
            });

            clearTimeout(timeoutId);

            if (!response.ok) throw new Error("API Error");

            const data = await response.json();
            const aiResponse = data.choices[0].message.content;
            
            chatHistory.push({ role: "assistant", content: aiResponse });
            typingIndicator.style.display = "none";
            await typeWriterEffect(aiResponse);
        } catch (error) {
            typingIndicator.style.display = "none";
            let errMsg = "Ù…Ø¹Ù„Ø´ ÙŠØ§ Ø¨Ø·Ù„ØŒ Ø­ØµÙ„ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ.";
            if (error.name === 'AbortError') errMsg = "Ø§Ù„Ø±Ø¯ Ø£Ø®Ø¯ ÙˆÙ‚Øª Ø·ÙˆÙŠÙ„ Ø£ÙˆÙŠ.. Ø­Ø§ÙˆÙ„ ØªØ³Ø£Ù„ Ø³Ø¤Ø§Ù„ Ø£Ù‚ØµØ± ÙŠØ§ Ø¹Ù…Ù„Ø§Ù‚.";
            addMessage(errMsg, "bot");
        }
    }

    function handleSend() {
        const text = chatInput.value.trim();
        if (isTyping) { isTyping = false; return; }
        if (!text) return;
        addMessage(text, "user");
        chatInput.value = "";
        askAI(text);
    }

    sendBtn.onclick = handleSend;
    chatInput.onkeypress = (e) => { if (e.key === 'Enter') handleSend(); };
    
    document.getElementById("clear-btn").onclick = () => {
        if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) {
            localStorage.removeItem('giant_chat_history');
            chatHistory = [];
            chatMessages.innerHTML = "";
            addMessage("Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§ØªÙ…Ø³Ø­ØªØŒ Ø£Ù†Ø§ Ø¬Ø§Ù‡Ø² Ù„Ø£ÙŠ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ ÙŠØ§ Ø¨Ø·Ù„.", "bot", false);
        }
    };

    // ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.lang = 'ar-EG';
        const vBtn = document.getElementById("voice-btn");
        
        vBtn.onclick = () => { 
            try { recognition.start(); vBtn.classList.add('active'); } 
            catch(e) { recognition.stop(); }
        };

        recognition.onresult = (e) => {
            chatInput.value = e.results[0][0].transcript;
            vBtn.classList.remove('active');
            handleSend();
        };
        recognition.onend = () => vBtn.classList.remove('active');
        recognition.onerror = () => vBtn.classList.remove('active');
    }

    loadChat();
</script>
</body>
</html>
