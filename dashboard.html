<!doctype html>
<html lang="ar" dir="rtl">                  
<head>                  
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />                  
  <title>Ù…Ù†ØµØ© Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚ - THE GIANT</title>                  
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>                  
    :root {                  
      --bg: #0b0f19; --card: #111827; --accent: #00b2ff;                  
      --accent-gradient: linear-gradient(90deg, #00b2ff, #7ee8fa, #00b2ff);
      --muted: #64748b; --ok: #10b981; --danger: #ef4444; --glass-border: rgba(0, 178, 255, 0.2);
    }                  
    body {                  
        margin: 0; font-family: 'Cairo', sans-serif; background-color: var(--bg); color: #fff;
        direction: rtl; overflow-x: hidden; opacity: 0; animation: fadeIn 1.2s ease-in forwards;
    }
    @keyframes fadeIn { to { opacity: 1; } }
    header {                  
      background-color: #0b0f19; display: flex; justify-content: space-between; align-items: center;                  
      padding: 1rem 1.5rem; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--glass-border);
    }
    .logo { display: flex; align-items: center; gap: 0.5rem; }
    .logo img { width: 45px; height: 45px; }
    .logo h1 {
        font-size: 1.6rem; background: var(--accent-gradient); -webkit-background-clip: text;
        -webkit-text-fill-color: transparent; font-family: 'Orbitron', sans-serif;
        margin: 0; font-weight: 800; letter-spacing: 1px; text-transform: uppercase;
    }
    .menu-icon { font-size: 1.8rem; cursor: pointer; color: #fff; }
    .main { max-width: 1000px; margin: 20px auto; padding: 0 15px; text-align: center; }                  
    .banner {                  
      background: linear-gradient(145deg, #111827, #0d1320); color: var(--accent);
      padding: 2rem 1.5rem; border-radius: 15px; font-weight: bold; font-size: 1.3rem;                  
      margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.4); border: 1px solid var(--glass-border);
    }
    #teacherProfile {
      display: none; background: var(--card); border: 1px solid var(--accent);
      border-radius: 15px; padding: 15px; margin-bottom: 18px; align-items: center; gap: 15px; text-align: right;
    }
    .t-avatar { width: 70px; height: 70px; border-radius: 50%; border: 2px solid var(--accent); object-fit: cover; }
    .t-info h2 { margin: 0; color: var(--accent); font-size: 1.15rem; }
    .controls-container {
      background: var(--card); padding: 20px; border-radius: 15px; margin-top: 20px;
      border: 1px solid var(--glass-border); display: flex; flex-direction: column; gap: 15px;
    }
    .search-input, select { 
      width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #1e293b; 
      background: #0b0f19; color: #fff; font-size: 0.9rem; box-sizing: border-box;
    }
    .course-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 25px; }                  
    .course-card { 
        background: #111827; border-radius: 18px; overflow: hidden; border: 1px solid var(--glass-border); 
        transition: 0.3s; display: flex; flex-direction: column; text-align: right;
    }                  
    .course-card:hover { transform: translateY(-10px); border-color: var(--accent); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .card-header { padding: 15px; }
    .course-card h3 { color: var(--accent); margin: 5px 0; }
    .price-tag { color: var(--ok); font-weight: bold; font-size: 1.1rem; }
    .btn { border: 0; padding: 12px; border-radius: 10px; width: 100%; cursor: pointer; font-weight: 700; transition: 0.3s; font-family: 'Cairo'; }                  
    .buy-btn { background: var(--accent); color: #fff; }                  
    .view-btn { background: #059669; color: #fff; }                  
    .menu {
        position: fixed; top: 0; right: -280px; background-color: #111827; width: 260px; height: 100%; 
        box-shadow: -2px 0 10px rgba(0,0,0,0.5); display: flex; flex-direction: column; align-items: center;
        padding-top: 5rem; transition: right 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); z-index: 999; border-left: 2px solid var(--accent);
    }
    .menu.active { right: 0; }
    .menu a {
        color: #fff; text-decoration: none; font-size: 1.1rem; margin: 0.5rem 0; background-color: var(--accent); 
        padding: 0.7rem 1.5rem; border-radius: 8px; transition: 0.3s; width: 80%; text-align: center;
    }
        /* Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø© */
    .modal { 
        position: fixed; inset: 0; 
        background: rgba(0, 0, 0, 0.7); 
        backdrop-filter: blur(8px); /* ØªØ£Ø«ÙŠØ± Ø²Ø¬Ø§Ø¬ÙŠ Ø®Ù„Ù Ø§Ù„Ù†Ø§ÙØ°Ø© */
        display: none; align-items: center; justify-content: center; z-index: 2000;
        animation: fadeIn 0.3s ease;
    }

    .modal .box { 
        background: #111827; 
        border-radius: 24px; 
        padding: 30px; 
        width: 90%; 
        max-width: 420px; 
        border: 1px solid var(--glass-border); 
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        text-align: center;
        position: relative;
    }

    .whatsapp-contact {
        background: rgba(16, 185, 129, 0.1);
        border: 1px dashed var(--ok);
        border-radius: 12px;
        padding: 15px;
        margin: 20px 0;
        color: #fff;
    }

    #activationCodeInput {
        background: #0b0f19;
        border: 2px solid #1e293b;
        font-size: 1.2rem;
        font-weight: bold;
        color: var(--accent);
        text-transform: uppercase;
        margin-top: 10px;
        transition: 0.3s;
    }

    #activationCodeInput:focus {
        border-color: var(--accent);
        box-shadow: 0 0 15px rgba(0, 178, 255, 0.2);
    }
    
    @keyframes spin { to { transform: rotate(360deg); } }
    @media (max-width: 600px) { .logo h1 { font-size: 1.2rem; } }
  </style>                  
</head>                  
<body>                  
<header>                  
  <div class="menu-icon" id="menuToggle">â˜°</div>
  <div class="logo"><img src="logo.png" alt="THE GIANT"><h1>THE GIANT</h1></div>
  <div id="themeToggle" style="visibility: hidden;">ğŸŒ™</div> </header>                  
<div class="menu" id="sideMenu"></div>
<div class="main">                  
  <div class="banner" id="bannerText">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØ© Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚.. ğŸš€</div>
  <div id="teacherProfile">
    <img src="" id="teacherImg" class="t-avatar" alt="M">
    <div class="t-info">
      <h2 id="teacherName">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³</h2>
      <p id="teacherSubject" style="margin:0; font-size:0.9rem; color:#ccc;">Ù…Ø¯Ø±Ø³ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</p>
      <div style="font-size: 0.8rem; color: var(--muted); margin-top:5px;">Ø§Ø³Ù… Ø§Ù„Ø³ÙƒØ±ØªÙŠØ±Ø©: <span id="assistantName" style="color:#fff">--</span></div>
      <div style="font-size: 0.8rem; color: var(--muted); margin-top:5px;">Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒØ±ØªÙŠØ±Ø©: <span id="assistantPhone" style="color:#fff">--</span></div>
    </div>
  </div>
  <div class="controls-container">
    <input type="text" id="searchInput" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒÙˆØ±Ø³ Ø£Ùˆ Ù…Ø§Ø¯Ø© Ø¯Ø±Ø§Ø³ÙŠØ©...">
    <select id="teacherSelect"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø±Ø³ --</option></select>
  </div>                  
  <div id="loader"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰...</p></div>
  <div id="coursesContainer" class="course-grid"></div>                  
</div>
<div id="buyModal" class="modal">                  
  <div class="box">                  
    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ”</div>
    <h3 id="modalCourseTitle" style="color: var(--accent); margin-bottom: 5px;">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3>
    <p style="color: var(--muted); font-size: 0.9rem; margin-top: 0;">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù„ÙØªØ­ Ø§Ù„Ø¯Ø±ÙˆØ³ ÙÙˆØ±Ø§Ù‹</p>

    <div class="whatsapp-contact">
        <p style="margin: 0 0 8px 0; font-size: 0.85rem;">Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯ ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨ (Ø§Ù„Ø³Ø¹Ø±: <strong id="modalPrice" style="color: var(--ok);">0</strong> Ø¬.Ù…)</p>
        <a href="https://wa.me/201221015966" target="_blank" style="text-decoration: none; color: var(--ok); font-weight: bold; font-size: 1.2rem; display: block;">
            01221015966ğŸŸ¢
        </a>
    </div>

    <input type="text" id="activationCodeInput" class="search-input" placeholder="XXXX-XXXX-XXXX">
    
    <div id="applyResult" style="height: 20px; margin: 10px 0; font-size: 0.85rem; font-weight: bold;"></div>

    <div style="display:flex; gap:12px; margin-top:10px;">
        <button id="applyCodeBtn" class="btn buy-btn" style="flex: 2;">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¢Ù†</button>
        <button id="closeModalBtn" class="btn" style="background:#374151; color:#fff; flex: 1;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>                  
</div>

<script type="module">                
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";                  
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";                  
import { getDatabase, ref, get, set, child } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {    
  apiKey: "AIzaSyDW80ZbwOB7QHHW76kSL9cqlzMoyPFZ7nI", authDomain: "ylearn-fe1fa.firebaseapp.com",    
  databaseURL: "https://ylearn-fe1fa-default-rtdb.firebaseio.com", projectId: "ylearn-fe1fa",    
  storageBucket: "ylearn-fe1fa.appspot.com", messagingSenderId: "1092852055944", appId: "1:1092852055944:web:85c3df7cf4c0cbcdca043d"    
};

const app = initializeApp(firebaseConfig); const auth = getAuth(app); const db = getDatabase(app);  
const sideMenu = document.getElementById('sideMenu'); const menuToggle = document.getElementById('menuToggle');
const teacherSelect = document.getElementById('teacherSelect'); const searchInput = document.getElementById('searchInput');
const loader = document.getElementById('loader'); const coursesContainer = document.getElementById('coursesContainer');

menuToggle.onclick = () => { sideMenu.classList.toggle('active'); menuToggle.textContent = sideMenu.classList.contains('active') ? 'âœ•' : 'â˜°'; };

let currentCourse = null, currentUid = null, studentGrade = null, allTeachers = {}, allCourses = {};

onAuthStateChanged(auth, async (user) => {
  if (!user) return (window.location.href = 'login.html');
  currentUid = user.uid; const dbRef = ref(db);
  const userSnap = await get(child(dbRef, `users/${currentUid}`));
  const userData = userSnap.val() || {}; studentGrade = userData.grade || null; 
  document.getElementById('bannerText').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${userData.fullName || 'Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨'}! ğŸš€`;
  sideMenu.innerHTML = `<div style="padding:1rem; color:var(--accent)">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a><a href="performance.html">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡</a><a href="freevid.html">ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ©</a><a href="#" id="logoutBtn" style="background:#ef4444">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>`;
  document.getElementById('logoutBtn').onclick = () => confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ") && signOut(auth).then(()=>location.reload());
  
  loader.style.display = 'block';
  const [tSnap, cSnap] = await Promise.all([get(child(dbRef, 'teachers')), get(child(dbRef, 'courses'))]);
  allTeachers = tSnap.val() || {}; allCourses = cSnap.val() || {}; loader.style.display = 'none';
  
  teacherSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø±Ø³ --</option>';
  Object.entries(allTeachers).forEach(([id, t]) => { 
    if (studentGrade && t.grade === studentGrade) { 
      const opt = document.createElement('option'); opt.value = id; opt.textContent = t.name; 
      teacherSelect.appendChild(opt); 
    } 
  });

  teacherSelect.onchange = () => { displayTeacherInfo(); loadVisibleCourses(); };
  searchInput.oninput = loadVisibleCourses;

  // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
  displayTeacherInfo(); 
  loadVisibleCourses();
});

function displayTeacherInfo() {
    const tid = teacherSelect.value; const profile = document.getElementById('teacherProfile');
    if (tid && allTeachers[tid]) {
        const t = allTeachers[tid]; document.getElementById('teacherName').textContent = t.name;
        document.getElementById('teacherSubject').textContent = t.subject || "Ù…Ø¯Ø±Ø³ Ù…ØªØ®ØµØµ";
        document.getElementById('teacherImg').src = t.photoUrl || "logo.png";
        document.getElementById('assistantName').textContent = t.secretary || t.name || "--";
        document.getElementById('assistantPhone').textContent = t.secretaryPhone || t.phone || "--";
        profile.style.display = 'flex';
    } else { profile.style.display = 'none'; }
}

async function loadVisibleCourses() {
  const tid = teacherSelect.value, term = searchInput.value.toLowerCase().trim();
  coursesContainer.innerHTML = ''; if (!tid && !term) return;
  loader.style.display = 'block';
  
  const [pSnap, vSnap] = await Promise.all([
      get(ref(db, `students/${currentUid}/purchased`)), 
      get(ref(db, `grades/${studentGrade}/videos`))
  ]);
  
  const purchased = pSnap.val() || {}, gVideos = vSnap.val() || {};

  for (const [id, c] of Object.entries(allCourses)) {
    if ((tid && c.teacherId !== tid && !term) || (term && !c.name.toLowerCase().includes(term))) continue;
    renderCard(id, c, purchased[id], false); 
  }
  for (const [id, v] of Object.entries(gVideos)) {
    if ((term && !v.title.toLowerCase().includes(term)) || (!tid && !term)) continue;
    renderCard(id, { name: v.title, description: v.note, price: v.price }, purchased[id], true);
  }
  loader.style.display = 'none';
}


function renderCard(id, c, isP, isL) {
  const isF = (!c.price || Number(c.price) === 0); const card = document.createElement('div'); card.className = 'course-card';
  card.innerHTML = `<div class="card-header"><h3>${c.name}</h3></div><div style="padding:0 15px 15px; flex-grow:1;"><p style="font-size:0.85rem; color:#ccc; height:40px; overflow:hidden;">${c.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹'}</p><div class="price-tag">${isF ? 'Ù…Ø¬Ø§Ù†ÙŠ ğŸ' : c.price + ' Ø¬.Ù…'}</div></div><div style="padding:15px; border-top:1px solid var(--glass-border)"><button class="btn ${isP || isF ? 'view-btn' : 'buy-btn'}">${isP || isF ? 'Ù…Ø´Ø§Ù‡Ø¯Ø©' : 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰'}</button></div>`;
  card.querySelector('button').onclick = () => { if (isP || isF) window.location.href = isL ? `view.html?lessonId=${id}&grade=${studentGrade}` : `courseContent.html?courseId=${id}`; else openBuyModal({ id, name: c.name, price: c.price }); };
  coursesContainer.appendChild(card);
}

function openBuyModal(course) {
  currentCourse = course; document.getElementById('modalCourseTitle').textContent = course.name;
  document.getElementById('modalPrice').textContent = course.price; document.getElementById('buyModal').style.display = 'flex';
}

document.getElementById('closeModalBtn').onclick = () => document.getElementById('buyModal').style.display = 'none';

document.getElementById('applyCodeBtn').onclick = async () => {
  const code = document.getElementById('activationCodeInput').value.trim().toUpperCase(); if (!code) return;
  const res = document.getElementById('applyResult'); res.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚..."; res.style.color = "white";
  const usedSnap = await get(ref(db, `usedCodes/${code}`));
  if (usedSnap.exists()) { res.style.color = 'red'; res.textContent = "Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹!"; return; }
  const prefix = currentCourse.id.slice(-5).toUpperCase(); let isValid = false;
  for (let i = 1; i <= 2000; i++) { if (code.includes(prefix) && code.includes((2000 + i).toString())) { isValid = true; break; } }
  if (isValid) {
      await Promise.all([set(ref(db, `usedCodes/${code}`), { uid: currentUid, at: new Date().toISOString() }), set(ref(db, `students/${currentUid}/purchased/${currentCourse.id}`), true)]);
      res.style.color = 'green'; res.textContent = "ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!"; setTimeout(()=>location.reload(), 1000);
  } else { res.style.color = 'red'; res.textContent = "Ø§Ù„ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦!"; }
};
</script>
</body>
</html>
